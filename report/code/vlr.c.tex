\begin{Verbatim}[commandchars=\\\{\},codes={\catcode`\$=3\catcode`\^=7\catcode`\_=8\relax}]
\PY{k+kr}{inline}\PY{+w}{ }\PY{k+kt}{uint64\PYZus{}t}\PY{+w}{ }\PY{n+nf}{get\PYZus{}version\PYZus{}number}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{k}{return}\PY{+w}{ }\PY{n}{this}\PY{o}{\PYZhy{}}\PY{o}{\PYZgt{}}\PY{n}{version\PYZus{}number}\PY{p}{;}\PY{p}{\PYZcb{}}

\PY{k+kr}{inline}\PY{+w}{ }\PY{k+kt}{uint64\PYZus{}t}\PY{+w}{ }\PY{n+nf}{version\PYZus{}lock::read\PYZus{}lock}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }
\PY{+w}{    }\PY{c+cm}{/* just return the current version number }
\PY{c+cm}{     * no need of checking the lock status*/}
\PY{+w}{    }\PY{k}{return}\PY{+w}{ }\PY{n}{get\PYZus{}version\PYZus{}number}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}

\PY{k+kr}{inline}\PY{+w}{ }\PY{k+kt}{bool}\PY{+w}{ }\PY{n+nf}{version\PYZus{}lock::read\PYZus{}unlock}\PY{p}{(}\PY{k+kt}{uint64\PYZus{}t}\PY{+w}{ }
\PY{+w}{        }\PY{n}{initial\PYZus{}version\PYZus{}number}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }
\PY{+w}{    }\PY{k+kt}{uint64\PYZus{}t}\PY{+w}{ }\PY{n}{current\PYZus{}version\PYZus{}number}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{get\PYZus{}version\PYZus{}number}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }
\PY{+w}{    }\PY{c+cm}{/* if both version numbers are equal means no write }
\PY{c+cm}{     * has happened during the read operation.}
\PY{c+cm}{     * so read can return successful*/}
\PY{+w}{    }\PY{k}{if}\PY{+w}{ }\PY{p}{(}\PY{n}{initial\PYZus{}version\PYZus{}number}\PY{+w}{ }\PY{o}{=}\PY{o}{=}\PY{+w}{ }\PY{n}{current\PYZus{}version\PYZus{}number}\PY{p}{)}
\PY{+w}{        }\PY{k}{return}\PY{+w}{ }\PY{n+nb}{true}\PY{p}{;}
\PY{+w}{    }
\PY{+w}{    }\PY{c+cm}{/* if version numbers mismatch means that some writer }
\PY{c+cm}{     * has completed before the read operation*/}
\PY{+w}{    }\PY{k}{return}\PY{+w}{ }\PY{n+nb}{false}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
